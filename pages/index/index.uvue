<template>
	<view class="index-container">
		<!-- é¡¶éƒ¨çŠ¶æ€æ  -->
		<view class="status-bar">
			<text class="app-name">å† æ™ºæœªæ¥å†™ä½œåŠ©æ‰‹</text>
		</view>

		<!-- ç”¨æˆ·çŠ¶æ€åŒºåŸŸ - ç™»å½•å’Œå‡çº§äº’æ–¥æ˜¾ç¤º -->
		<view class="user-status-section">
			<!-- æœªç™»å½•çŠ¶æ€ï¼šæ˜¾ç¤ºç™»å½•æŒ‰é’® -->
			<view v-if="!isLoggedIn" class="user-status-left">
				<button class="login-btn" @click="goToLogin">ç™»å½•</button>
			</view>
			
			<!-- å·²ç™»å½•çŠ¶æ€ï¼šæ˜¾ç¤ºç”¨æˆ·ç±»å‹å’Œå‡çº§æŒ‰é’® -->
			<view v-else class="user-status-left">
				<text class="user-type">{{ userInfo.isVip ? 'VIPç”¨æˆ·' : 'æ™®é€šç”¨æˆ·' }}</text>
				<button v-if="!userInfo.isVip" class="upgrade-btn" @click="goToUpgrade">å‡çº§</button>
			</view>
		</view>
		


		<!-- æ¨èæ¨ªå¹… -->
		<view class="recommend-banner" @click="goToDesktop">
			<text class="banner-text">æ›´æ¨èç”µè„‘ç«¯ä½¿ç”¨ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§: www.wsxai.com</text>
		</view>

		<!-- ä¸»è¦å†…å®¹ -->
		<scroll-view class="main-content" scroll-y="true">
			<!-- çƒ­é—¨åˆ›ä½œæ¨¡å— -->
			<view class="hot-creation-section">
				<view class="section-header">
					<view class="section-title">
						<text class="title-text">
							<text class="title-icon">ğŸ‘</text>
						çƒ­é—¨åˆ›ä½œ<text class="title-desc">AIåŸåˆ›ï¼Œæ— ç‰ˆæƒé£é™©</text>
						
					<text class="more-link" @click="goToMore">æ›´å¤š</text>  
				</text>

					</view>
				</view>
			</view>

			<!-- åˆ›ä½œå·¥å…·ç½‘æ ¼ -->
			<view class="creation-grid">
				<view class="grid-item" @click="goToPaperAssistant">
					<view class="item-icon paper-icon">W</view>
					<text class="item-title">è®ºæ–‡åŠ©æ‰‹</text>
					<text class="item-desc">åŸºäºä¸“ä¸šçŸ¥è¯†åº“çš„AIè®ºæ–‡ä¸“å®¶</text>
					<view class="item-tag">é•¿æ–‡</view>
				</view>
				
				<view class="grid-item" @click="goToPPT">
					<view class="item-icon ppt-icon">P</view>
					<text class="item-title">PPT</text>
					<text class="item-desc">ä¸€é”®å¿«é€Ÿç”Ÿæˆï¼Œè½»æ¾æå®šPPT</text>
					<view class="item-tag">é•¿æ–‡</view>
				</view>
				
				<view class="grid-item" @click="goToExperience">
					<view class="item-icon experience-icon">ğŸ“„</view>
					<text class="item-title">å¿ƒå¾—ä½“ä¼š</text>
					<text class="item-desc">ä»»ä½•å¿ƒå¾—ä½“ä¼šï¼Œéƒ½èƒ½ä¸Šä»·å€¼ï¼</text>
					<view class="item-tag">é•¿æ–‡</view>
				</view>
				
				<view class="grid-item" @click="goToSpeech">
					<view class="item-icon speech-icon">ğŸ¤</view>
					<text class="item-title">æ¼”è®²ç¨¿</text>
					<text class="item-desc">å„ç±»ç”¨é€”ã€é£æ ¼æ¼”è®²ç¨¿å¿«é€Ÿç”Ÿæˆï¼</text>
					<view class="item-tag">é•¿æ–‡</view>
				</view>
			</view>

			<!-- ç©ºç™½åŒºåŸŸ -->
			<view class="blank-section"></view>
		</scroll-view>

		<!-- åº•éƒ¨AIå¯¹è¯åŒºåŸŸ -->
		<view class="ai-chat-section">
			<!-- é€‰é¡¹æ  -->
			<view class="chat-options">
				<view class="option-item" @click="toggleOption('deepThinking')">
					<view class="option-circle" :class="{ active: options.deepThinking }">
						<text v-if="options.deepThinking" class="option-check">âœ“</text>
					</view>
					<text class="option-text">æ·±åº¦æ€è€ƒ(R1)</text>
				</view>
				<view class="option-item" @click="toggleOption('networkQuery')">
					<view class="option-circle" :class="{ active: options.networkQuery }">
						<text v-if="options.networkQuery" class="option-check">âœ“</text>
					</view>
					<text class="option-text">è”ç½‘æé—®</text>
				</view>
				<view class="option-item" @click="toggleOption('knowledgeQuery')">
					<view class="option-circle" :class="{ active: options.knowledgeQuery }">
						<text v-if="options.knowledgeQuery" class="option-check">âœ“</text>
					</view>
					<text class="option-text">çŸ¥è¯†åº“æé—®</text>
				</view>
				<text class="history-link" @click="goToHistory">æé—®è®°å½•</text>
			</view>

			<!-- AIå¯¹è¯è¾“å…¥çª—å£ -->
			<view class="chat-input-window">
				<input 
					class="chat-input" 
					v-model="questionText" 
					placeholder="æƒ³äº†è§£ä»€ä¹ˆçŸ¥è¯†,å¿«æ¥é—®é—®"
					@confirm="sendQuestion"
				/> 
				<view class="input-controls">
					<text class="image-icon" @click="uploadImage">ä¸Šä¼ å›¾ç‰‡</text>
					<text class="send-icon" @click="sendQuestion">å‘é€</text>
				</view>
			</view>
		</view>
	</view>
</template>

<script>
import auth from '@/utils/auth.js'

export default {
	data() {
		return {
			isLoggedIn: false, // ç™»å½•çŠ¶æ€
			userInfo: {
				isVip: false,
				nickname: '',
				coins: 0
			},
			options: {
				deepThinking: true,
				networkQuery: true,
				knowledgeQuery: true
			},
			questionText: ''
		}
	},
	onLoad() {
		this.checkLoginStatus()
	},
	onShow() {
		this.checkLoginStatus()
		
		// æ£€æŸ¥æ˜¯å¦æœ‰ç™»å½•çŠ¶æ€æ›´æ–°
		if (auth.checkAndClearLoginStatusUpdated()) {
			this.checkLoginStatus()
		}
	},
	methods: {
			checkLoginStatus() {
		// ä½¿ç”¨å…¨å±€ç™»å½•çŠ¶æ€ç®¡ç†å·¥å…·
		const result = auth.checkLoginStatus()
		
		if (result.isLoggedIn) {
			this.isLoggedIn = true
			this.userInfo = { ...this.userInfo, ...result.userInfo }
		} else {
			this.isLoggedIn = false
			this.userInfo = {
				isVip: false,
				nickname: '',
				coins: 0
			}
		}
	},
	
	clearLoginData() {
		// ä½¿ç”¨å…¨å±€ç™»å½•çŠ¶æ€ç®¡ç†å·¥å…·æ¸…é™¤æ•°æ®
		auth.clearLoginData()
		
		this.isLoggedIn = false
		this.userInfo = {
			isVip: false,
			nickname: '',
			coins: 0
		}
	},
		
		loadUserData() {
			// ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼ˆä»…åœ¨éœ€è¦æ—¶è°ƒç”¨ï¼‰
			const savedUserInfo = uni.getStorageSync('userInfo')
			if (savedUserInfo) {
				this.userInfo = { ...this.userInfo, ...savedUserInfo }
			}
		},
		
		goToLogin() {
			uni.navigateTo({
				url: '/pages/login/login'
			})
		},
		
		goToUpgrade() {
			uni.navigateTo({
				url: '/pages/profile/upgrade-member/upgrade-member'
			})
		},
		
		goToDesktop() {
			uni.navigateTo({
				url: '/pages/webview/webview?url=' + encodeURIComponent('https://www.wsxai.com/')
			})
		},
		
		goToMore() {
			uni.navigateTo({
				url: '/pages/creation/creation'
			})
		},
		
		goToPaperAssistant() {
			// æ ¹æ®PRDï¼Œè®ºæ–‡åŠ©æ‰‹å¯ä»¥ç›´æ¥ä»é¦–é¡µè¿›å…¥
			uni.navigateTo({
				url: '/pages/creation/paper-assistant/paper-assistant'
			})
		},
		
		goToPPT() {
			uni.navigateTo({
				url: '/pages/creation/ppt/ppt'
			})
		},
		
		goToExperience() {
			uni.navigateTo({
				url: '/pages/creation/experience/experience'
			})
		},
		
		goToSpeech() {
			uni.navigateTo({
				url: '/pages/creation/speech/speech'
			})
		},
		
		toggleOption(option) {
			this.options[option] = !this.options[option]
		},
		
		goToHistory() {
			uni.navigateTo({
				url: '/pages/qa/history/history'
			})
		},
		
		startVoiceInput() {
			uni.showToast({
				title: 'è¯­éŸ³è¾“å…¥åŠŸèƒ½å¼€å‘ä¸­',
				icon: 'none'
			})
		},
		
		uploadImage() {
			// æ˜¾ç¤ºé€‰æ‹©æ¥æºçš„æ“ä½œèœå•
			uni.showActionSheet({
				itemList: ['ä»ç›¸å†Œé€‰æ‹©', 'æ‹ç…§'],
				success: (res) => {
					let sourceType: string[] = []
					if (res.tapIndex === 0) {
						// ä»ç›¸å†Œé€‰æ‹©
						sourceType = ['album']
					} else if (res.tapIndex === 1) {
						// æ‹ç…§
						sourceType = ['camera']
					}
					
					// æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨
					uni.chooseImage({
						count: 1,
						sizeType: ['compressed'],
						sourceType: sourceType,
						success: (res) => {
							uni.showToast({
								title: 'å›¾ç‰‡å·²é€‰æ‹©',
								icon: 'success'
							})
							// è¿™é‡Œå¯ä»¥æ·»åŠ å›¾ç‰‡å¤„ç†é€»è¾‘
							// æ¯”å¦‚ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–è¿›è¡ŒAIè¯†åˆ«
						},
						fail: (err) => {
							uni.showToast({
								title: 'é€‰æ‹©å›¾ç‰‡å¤±è´¥',
								icon: 'none'
							})
						}
					})
				}
			})
		},
		
		sendQuestion() {
			if (!this.questionText.trim()) {
				uni.showToast({
					title: 'è¯·è¾“å…¥é—®é¢˜',
					icon: 'none'
				})
				return
			}
			
			uni.showLoading({
				title: 'æ€è€ƒä¸­...'
			})
			
			// æ¨¡æ‹ŸAIå›ç­”
			setTimeout(() => {
				uni.hideLoading()
				uni.showToast({
					title: 'AIå›ç­”åŠŸèƒ½å¼€å‘ä¸­',
					icon: 'none'
				})
				this.questionText = ''
			}, 2000)
		}
	}
}
</script>

<style>
.index-container {
	flex: 1;
	background-color: #ffffff;
}

/* é¡¶éƒ¨çŠ¶æ€æ  */
.status-bar {
	display: flex;
	justify-content: flex-start;
	align-items: center;
	padding: 20rpx 30rpx;
	border-bottom: 1rpx solid #f0f0f0;
	gap: 20rpx;
}

.login-btn {
	background-color: #007aff;
	color: #ffffff;
	border: none;
	border-radius: 6rpx;
	padding: 8rpx 16rpx;
	font-size: 24rpx;
}

.app-name {
	font-size: 28rpx;
	font-weight: 600;
	color: #000000;
}

/* ç”¨æˆ·çŠ¶æ€åŒºåŸŸ */
.user-status-section {
	display: flex;
	justify-content: flex-start;
	align-items: center;
	padding: 20rpx 30rpx;
}

.user-status-left {
	display: flex;
	align-items: center;
	gap: 15rpx;
	width: 100%;
}

.user-type {
	font-size: 26rpx;
	color: #666666;
}

.upgrade-btn {
	background-color: #007aff;
	color: #ffffff;
	border: none;
	border-radius: 6rpx;
	padding: 8rpx 16rpx;
	font-size: 22rpx;
}

/* æ¨èæ¨ªå¹… */
.recommend-banner {
	display: flex;
	justify-content: center;
	align-items: center;
	background-color: #e8f5e8;
	padding: 20rpx 30rpx;
	margin: 0 30rpx 30rpx 30rpx;
	border-radius: 12rpx;
}

.banner-text {
	font-size: 24rpx;
	color: #2d5a2d;
}

/* ä¸»è¦å†…å®¹ */
.main-content {
	flex: 1;
	padding: 0 30rpx;
}

/* çƒ­é—¨åˆ›ä½œæ¨¡å— */
.hot-creation-section {
	margin-bottom: 40rpx;
}

.section-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 20rpx;
}

.section-title {
	display: flex;
	align-items: center;
	gap: 10rpx;
}

.title-icon {
	font-size: 28rpx;
}

.title-text {
	font-size: 30rpx;
	font-weight: 600;
	color: #000000;
}

.title-desc {
	font-size: 22rpx;
	color: #666666;
}

.more-link {
	font-size: 26rpx;
	color: #007aff;
	white-space: nowrap;
}

/* åˆ›ä½œå·¥å…·ç½‘æ ¼ */
.creation-grid {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 20rpx;
	margin-bottom: 40rpx;
}

.grid-item {
	background-color: #ffffff;
	border: 1rpx solid #e0e0e0;
	border-radius: 16rpx;
	padding: 30rpx;
	position: relative;
	display: flex;
	flex-direction: column;
	align-items: center;
	text-align: center;
}

.item-icon {
	width: 80rpx;
	height: 80rpx;
	border-radius: 12rpx;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 36rpx;
	font-weight: 600;
	color: #ffffff;
	margin-bottom: 20rpx;
}

.paper-icon {
	background-color: #007aff;
}

.ppt-icon {
	background-color: #ff9500;
}

.experience-icon {
	background-color: #00c851;
}

.speech-icon {
	background-color: #ffcc00;
}

.item-title {
	font-size: 28rpx;
	font-weight: 600;
	color: #000000;
	margin-bottom: 10rpx;
}

.item-desc {
	font-size: 22rpx;
	color: #666666;
	line-height: 1.4;
	margin-bottom: 15rpx;
}

.item-tag {
	position: absolute;
	top: 15rpx;
	right: 15rpx;
	background-color: #e3f2fd;
	color: #007aff;
	font-size: 20rpx;
	padding: 4rpx 8rpx;
	border-radius: 4rpx;
}

/* ç©ºç™½åŒºåŸŸ */
.blank-section {
	height: 200rpx;
}

/* åº•éƒ¨AIå¯¹è¯åŒºåŸŸ - ä¼˜åŒ–å®½åº¦ç¡®ä¿ä¸€è¡Œæ˜¾ç¤º */
.ai-chat-section {
	background-color: #ffffff;
	border-top: 1rpx solid #e0e0e0;
	padding: 8rpx 12rpx;
	width: 100%;
	box-sizing: border-box;
}

.chat-options {
	display: flex;
	align-items: center;
	gap: 6rpx;
	margin-bottom: 8rpx;
	flex-wrap: nowrap;
	overflow-x: auto;
	min-height: 28rpx;
	width: 100%;
}

.option-item {
	display: flex;
	align-items: center;
	gap: 2rpx;
	white-space: nowrap;
	flex-shrink: 0;
}

.option-circle {
	width: 14rpx;
	height: 14rpx;
	border-radius: 50%;
	border: 1rpx solid #e0e0e0;
	background-color: #ffffff;
	display: flex;
	align-items: center;
	justify-content: center;
	flex-shrink: 0;
}

.option-circle.active {
	background-color: #007aff;
	border-color: #007aff;
}

.option-check {
	font-size: 8rpx;
	color: #ffffff;
}

.option-text {
	font-size: 14rpx;
	color: #666666;
	white-space: nowrap;
}

.history-link {
	font-size: 14rpx;
	color: #007aff;
	margin-left: auto;
	white-space: nowrap;
	flex-shrink: 0;
}

.chat-input-window {
	display: flex;
	align-items: center;
	background-color: #f8f8f8;
	border-radius: 8rpx;
	padding: 6rpx;
	gap: 6rpx;
	min-height: 36rpx;
	width: 100%;
	box-sizing: border-box;
}

.voice-icon {
	font-size: 16rpx;
	color: #666666;
}

.chat-input {
	flex: 1;
	font-size: 18rpx;
	color: #000000;
	background-color: transparent;
	min-width: 0;
	max-width: 60%;
}

.chat-input::placeholder {
	color: #999999;
}

.input-controls {
	display: flex;
	flex-direction: row;
	gap: 8rpx;
	align-items: center;
	white-space: nowrap;
	flex-shrink: 0;
}

.image-icon {
	font-size: 16rpx;
	color: #007aff;
	white-space: nowrap;
}

.send-icon {
	font-size: 16rpx;
	color: #007aff;
	white-space: nowrap;
}
</style>
