{"version":3,"file":"auth.js","sources":["utils/auth.js"],"sourcesContent":["// 全局登录状态管理工具\nexport default {\n\t// 检查登录状态和30天免登录\n\tcheckLoginStatus() {\n\t\tconst token = uni.getStorageSync('token')\n\t\tconst savedUserInfo = uni.getStorageSync('userInfo')\n\t\tconst loginTime = uni.getStorageSync('loginTime')\n\t\t\n\t\tconsole.log('Auth工具 - 检查登录状态:', {\n\t\t\ttoken: !!token,\n\t\t\tuserInfo: !!savedUserInfo,\n\t\t\tloginTime: loginTime,\n\t\t\tcurrentTime: Date.now()\n\t\t})\n\t\t\n\t\t// 检查是否有登录信息\n\t\tif (token && savedUserInfo && loginTime) {\n\t\t\tconst currentTime = Date.now()\n\t\t\tconst thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000 // 30天的毫秒数\n\t\t\t\n\t\t\t// 检查是否在30天内\n\t\t\tif (currentTime - loginTime < thirtyDaysInMs) {\n\t\t\t\t// 30天内，自动登录\n\t\t\t\tconsole.log('Auth工具 - 登录有效，用户信息:', savedUserInfo)\n\t\t\t\treturn {\n\t\t\t\t\tisLoggedIn: true,\n\t\t\t\t\tuserInfo: savedUserInfo\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// 超过30天，清除登录信息\n\t\t\t\tconsole.log('Auth工具 - 登录已过期，清除数据')\n\t\t\t\tthis.clearLoginData()\n\t\t\t\treturn {\n\t\t\t\t\tisLoggedIn: false,\n\t\t\t\t\tuserInfo: null\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// 没有登录信息，设置为未登录状态\n\t\t\tconsole.log('Auth工具 - 未登录状态')\n\t\t\treturn {\n\t\t\t\tisLoggedIn: false,\n\t\t\t\tuserInfo: null\n\t\t\t}\n\t\t}\n\t},\n\t\n\t// 清除登录数据\n\tclearLoginData() {\n\t\tuni.removeStorageSync('token')\n\t\tuni.removeStorageSync('userInfo')\n\t\tuni.removeStorageSync('loginTime')\n\t\tuni.removeStorageSync('userAvatar')\n\t\tuni.removeStorageSync('phoneBound')\n\t\tuni.removeStorageSync('loginStatusUpdated')\n\t},\n\t\n\t// 设置登录状态更新标记\n\tsetLoginStatusUpdated() {\n\t\tuni.setStorageSync('loginStatusUpdated', Date.now())\n\t},\n\t\n\t// 检查并清除登录状态更新标记\n\tcheckAndClearLoginStatusUpdated() {\n\t\tconst loginStatusUpdated = uni.getStorageSync('loginStatusUpdated')\n\t\tif (loginStatusUpdated) {\n\t\t\tconsole.log('Auth工具 - 检测到登录状态更新标记')\n\t\t\tuni.removeStorageSync('loginStatusUpdated')\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t}\n} "],"names":["uni"],"mappings":";;AACA,MAAe,OAAA;AAAA;AAAA,EAEd,mBAAmB;AAClB,UAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAM,gBAAgBA,cAAAA,MAAI,eAAe,UAAU;AACnD,UAAM,YAAYA,cAAAA,MAAI,eAAe,WAAW;AAEhDA,kBAAAA,yCAAY,oBAAoB;AAAA,MAC/B,OAAO,CAAC,CAAC;AAAA,MACT,UAAU,CAAC,CAAC;AAAA,MACZ;AAAA,MACA,aAAa,KAAK,IAAK;AAAA,IAC1B,CAAG;AAGD,QAAI,SAAS,iBAAiB,WAAW;AACxC,YAAM,cAAc,KAAK,IAAK;AAC9B,YAAM,iBAAiB,KAAK,KAAK,KAAK,KAAK;AAG3C,UAAI,cAAc,YAAY,gBAAgB;AAE7CA,sBAAAA,0CAAY,uBAAuB,aAAa;AAChD,eAAO;AAAA,UACN,YAAY;AAAA,UACZ,UAAU;AAAA,QACV;AAAA,MACL,OAAU;AAENA,sBAAAA,MAAY,MAAA,OAAA,uBAAA,qBAAqB;AACjC,aAAK,eAAgB;AACrB,eAAO;AAAA,UACN,YAAY;AAAA,UACZ,UAAU;AAAA,QACV;AAAA,MACD;AAAA,IACJ,OAAS;AAENA,oBAAAA,MAAA,MAAA,OAAA,uBAAY,gBAAgB;AAC5B,aAAO;AAAA,QACN,YAAY;AAAA,QACZ,UAAU;AAAA,MACV;AAAA,IACD;AAAA,EACD;AAAA;AAAA,EAGD,iBAAiB;AAChBA,kBAAG,MAAC,kBAAkB,OAAO;AAC7BA,kBAAG,MAAC,kBAAkB,UAAU;AAChCA,kBAAG,MAAC,kBAAkB,WAAW;AACjCA,kBAAG,MAAC,kBAAkB,YAAY;AAClCA,kBAAG,MAAC,kBAAkB,YAAY;AAClCA,kBAAG,MAAC,kBAAkB,oBAAoB;AAAA,EAC1C;AAAA;AAAA,EAGD,wBAAwB;AACvBA,kBAAAA,MAAI,eAAe,sBAAsB,KAAK,IAAG,CAAE;AAAA,EACnD;AAAA;AAAA,EAGD,kCAAkC;AACjC,UAAM,qBAAqBA,cAAAA,MAAI,eAAe,oBAAoB;AAClE,QAAI,oBAAoB;AACvBA,oBAAAA,MAAA,MAAA,OAAA,uBAAY,sBAAsB;AAClCA,oBAAG,MAAC,kBAAkB,oBAAoB;AAC1C,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACP;AACF;;"}